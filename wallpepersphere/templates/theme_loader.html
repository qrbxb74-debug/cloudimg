<script>
    // Immediate Theme Application to prevent flash
    (function() {
        const serverTheme = "{{ theme_color }}";
        const serverMode = "{{ theme_mode }}";
        const localTheme = localStorage.getItem('theme-color');
        const localMode = localStorage.getItem('theme-mode');
        
        const theme = (serverTheme && serverTheme !== 'None' && serverTheme !== '#0a84ff') ? serverTheme : localTheme;
        if (theme) {
            document.documentElement.style.setProperty('--primary', theme);
            document.documentElement.style.setProperty('--primary-dark', theme);
        }
        
        const mode = (serverMode && serverMode !== 'None') ? serverMode : localMode;
        if (mode === 'light') document.documentElement.setAttribute('data-theme', 'light');
        else document.documentElement.removeAttribute('data-theme');
    })();
</script>